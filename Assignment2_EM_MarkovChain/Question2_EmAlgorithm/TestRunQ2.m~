K = 2; % number of clusters (number of Gaussians)
D = 2; % number of dimensions in each Gaussian

mu1 = [3, 4];
mu2 = [9, 8];

sigma1 = [1, 0.5; 0.5, 1];
sigma2 = [1, -0.2; -0.2, 1];

phi = [0.3, 0.7];
N = 1000;


%% Step 1: generate sample from the mixture of two bivariate Gaussians

rng('default') % reproducible

X = sampleGaussianMixture(N, {mu1, mu2}, {sigma1, sigma2}, phi); 


%% Step 2: implement the EM algorithm and get some results

[MU, SIGMA, PI] = EMAlgo(X, phi, K);

% Plotting the resulting mixture of gaussians: 

% Probability density of mixture: 
p_initial = @(x) phi(1) * mvnpdf(x, mu1, sigma1) + ...
    phi(2) * mvnpdf(x, mu2, sigma2) 

p_new = @(x) p(1) * mvnpdf(x, m(1,:), s{1}) + ...
    p(2) * mvnpdf(x, m(2,:), s{2}) 

%% Doing these steps from the start for B = 100 iterations
B = 100;
[avgMU, avgSIGMA, avgPI] = averageEMResults(B, {mu1, mu2}, {sigma1, sigma2}, N, phi);